<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-app.html">
<link rel="import" href="../../bower_components/google-map/google-map-directions.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/iron-collapse/iron-collapse.html">

<dom-module id="emsi-church-paper-card">
	<template>
		<style>
			:host {
				display: block;
			}

			@font-face {
			    font-family: MyriadProBold;
			    src: url(../fonts/MyriadPro-Bold.otf);
			}

			@font-face {
			    font-family: MyriadProRegular;
			    src: url(../fonts/MyriadPro-Regular.otf);
			}

			@font-face {
			    font-family: MyriadProSemibold;
			    src: url(../fonts/MyriadPro-Semibold.otf);
			}

			paper-card {
				color: black;
				border-radius: 20px;
				max-width:800px;
				width:100%;
				background-color: rgb(230,230,230);
				
				--paper-card-actions: {
					background-color: rgba(133,120,116, 0.75);
					border-radius: 0 0 20px 20px;
					color: white;
					padding-bottom: 0;
				}

				--paper-card-content: {
					padding-top: 20px;
					padding-left: 40px;
					padding-right: 40px;
				}
			}

			#title {
				font-size: 22pt;
				color: #236192;
				font-family: MyriadProBold;
				padding-bottom: 10px;
			}

			#address {
				font-size: 15pt;
				color: rgba(0,0,0,0.6);
				font-family: MyriadProSemibold;
			}

			#serviceTitle {
				font-size: 14pt;
				color: rgba(0,0,0,0.6);
				font-family: MyriadProSemibold;
				padding-top: 30px;
			}

			#serviceContainer {
				font-size: 13pt;
				color: rgba(0,0,0,0.6);
				font-family: MyriadProRegular;
				width: 50%;
				text-align: left;
				padding-bottom: 30px;
			}

			#distance {
				position: absolute;
				width: 100%;
				text-align: right;
				right:0;
				margin-right: 30px;
			}

			paper-button {
				font-family: MyriadProRegular;
				padding-top: 11px;
				padding-bottom: 10px;
			}

		</style>
      <google-map-directions id="dir"
          start-address=""
          end-address="{{address}}"
          response="{{data}}" 
          api-key="AIzaSyCmbUbEOc5qc59PyjgmM0kASRC9eS9JsDk"></google-map-directions>

		<paper-card elevation="3">
		  <div class="card-content">
		  	<div id="distance"> {{userDistanceText}} </div>
		  	<div id="title"> {{city}} </div>
		    <div id="address"> {{address}} </div>
			<div id="serviceTitle"> Sunday Worship </div>
			<table id="serviceContainer">
				<template is="dom-repeat" items="[[sundayServiceTime]]">
					<tr>
						<td>{{item.time}}</td> 
					    <td>{{item.name}}</td>
				  	</tr>
				</template>
			</table>

		    <!-- <h3> {{sundayServiceTime}}</h3>

		    <h3> {{userDistanceText}}</h3> -->
		  </div>
		  <div class="card-actions">
		  	<paper-button on-click="goToGoogleMaps"> Get Directions </paper-button>
		    <paper-button on-click="gotoChurchPage"> Learn More </paper-button>
		  </div>
		</paper-card>

	</template>
	<script>
		Polymer({
			is: 'emsi-church-paper-card',

			properties: {
				lang: {
					type: String,
					value: "en"
				} ,
				city: {
					type: String,
					value: "Towaco"
				} ,
				address: {
					type: String,
					value: "36 Alpine Road, Towaco, NJ 07082"
				} ,
				sundayServiceTime: {
					type: Array,
					value: []
				} , 
				learnMoreUrl: {
					type: String,
					value: "church/towaco"
				} ,
				data: {
				  type: Object,
				  value: {},
				  observer: "responseChanged"
				} ,
				userLocation: {
					type: String,
					value: "",
					observer: "userLocationChanged"
				} , 
				userDistance: {
					type: Object,
					value: {},
					observer: "distanceUpdated"
				} ,
				userDistanceText: String
			},

			distanceUpdated: function(newValue) {
				if(newValue == {}) return;
				var param = {};
				param.name = this.city;
				param.distance = newValue;
				this.fire('distance-updated', param);
			} ,

			responseChanged: function(newValue, oldValue) {
				if(oldValue == undefined) return;
				if(this.userLocation != "") {
					this.userDistance = newValue.routes[0].legs[0].distance;
					this.$.dir.startAddress = "";
				}
			} ,

			created: function() {
				//this.getLocation();
			} ,

			userLocationChanged: function(newValue) {
				if(newValue == "") return;
				this.$.dir.startAddress = newValue;
			} ,

			getLocation: function() {
				if (navigator.geolocation) {
					navigator.geolocation.getCurrentPosition(function(position){
						this.userLocation = position.coords.latitude + " " + position.coords.longitude;
					}.bind(this));
				}
			} ,

			goToGoogleMaps: function() {
				setTimeout(function(){
					window.location.href = 'http://maps.google.com/?q=' + this.address;
				}.bind(this), 0);
			} ,

			gotoChurchPage: function() {
				this.fire("emsi-route-change-event", {route: this.learnMoreUrl});
			}
		});
	</script>
</dom-module>