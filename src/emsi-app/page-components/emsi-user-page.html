<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/polymerfire/firebase-app.html">
<link rel="import" href="../../../bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="../../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../bower_components/paper-dialog/paper-dialog.html">

<!-- custom elements -->
<link rel="import" href="../util-components/emsi-button.html">
<link rel="import" href="../custom-components/emsi-account-information.html">
<link rel="import" href="../custom-components/emsi-personal-information.html">
<link rel="import" href="../custom-components/emsi-admin-information.html">
<link rel="import" href="../custom-components/emsi-church-information.html">
<link rel="import" href="../custom-components/emsi-church-news-information.html">
<link rel="import" href="../custom-components/emsi-church-events-information.html">
<link rel="import" href="../custom-components/emsi-church-sunday-services-information.html">
<link rel="import" href="../custom-components/emsi-church-ministries-information.html">

<!-- custom styles -->
<link rel="import" href="../../styles/user-styles.html">

<dom-module id="emsi-user-page">
  <template>
    <style include="user-styles"> </style>

    <firebase-auth app-name="emsionline" id="auth" user="{{user}}" on-error="handleError"> </firebase-auth>

    <!-- Set data property to locations part of database -->
    <firebase-document
      id="userDoc"
      app-name="emsionline"
      path= "users/[[uid]]"
      data="{{userData}}">
    </firebase-document>

    <div class="titleContainer"> Welcome, [[userData.name]] </div>

    <div class="contentContainer">
      <!-- user specific information -->
      <emsi-account-information user="[[user]]" lang="[[lang]]"> </emsi-account-information>
      <emsi-personal-information user-data="[[userData]]" lang="[[lang]]" uid="[[uid]]"> </emsi-personal-information>
      <emsi-admin-information user-data="[[userData]]" lang="[[lang]]"> </emsi-admin-information>

      <!-- church specific information -->
      <div class="titleContainerChurch"> [[location.name]] @ [[location.url]] </div>
      <emsi-church-information location="[[location]]" lang="[[lang]]"> </emsi-church-information>
      <emsi-church-news-information location="[[location]]" lang="[[lang]]"> </emsi-church-news-information>
      <emsi-church-events-information location="[[location]]" lang="[[lang]]"> </emsi-church-events-information>
      <emsi-church-sunday-services-information location="[[location]]" lang="[[lang]]"> </emsi-church-sunday-services-information>
      <emsi-church-ministries-information location="[[location]]" lang="[[lang]]"> </emsi-church-ministries-information>
    </div>
  </template>
  
  <script>
    class EMSIUserPage extends Polymer.Element {
      static get is() { return 'emsi-user-page'; }

      static get properties() {
        return {
          userData: Object,
          lang: String,
          route: Object,
          uid: String,
          user: Object,
          locations: Array,
          location: Object,
        };
      }

      static get observers() { 
        return [ 
          'languageChanged(lang)',
          'userDataReceived(userData)',
          'routeChanged(route)',
          'locationsChanged(locations)'
        ]; 
      }

      languageChanged(val) { this.isEnglish = val === "en"; }

      userDataReceived(v) {
        this.location = this.locations.find(o => o.name === v.admin);
      }

      routeChanged(route) {
        this.uid = !!route.path ? route.path.slice(1) : "";
      }

      locationsChanged(v) {
        this.location = v.find(o => o.name === this.userData.admin);
      }

      sendResyncEvent() {
        this.dispatchEvent(new CustomEvent('resync-firebase', { detail: {}, bubbles: true, composed: true }));
      }
    }

    window.customElements.define(EMSIUserPage.is, EMSIUserPage);
  </script>
</dom-module>